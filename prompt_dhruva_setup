# vim: ft=conf

function prompt_dhruva_precmd {
  git-info
  node-info
  ruby-info
}

function prompt_dhruva_setup {
  setopt LOCAL_OPTIONS
  unsetopt XTRACE KSH_ARRAYS
  prompt_opts=(cr percent subst)

# Load required functions.
  autoload -Uz add-zsh-hook

# Add hook for calling git-info before each command.
  add-zsh-hook precmd prompt_dhruva_precmd

# Set git-info parameters.
  zstyle ':prezto:module:git:info' verbose 'yes'
  zstyle ':prezto:module:git:info:action' format ' +%s'
  zstyle ':prezto:module:git:info:branch' format '%F{magenta}%b%f'
  zstyle ':prezto:module:git:info:commit' format ' %F{white}%.7c%f'
  zstyle ':prezto:module:git:info:indexed' format ' '
  zstyle ':prezto:module:git:info:unindexed' format ' '
  zstyle ':prezto:module:git:info:untracked' format ' '
  zstyle ':prezto:module:git:info:clean' format ' %F{green}✔%f'
  zstyle ':prezto:module:git:info:dirty' format ' %F{red}✗%f'
  zstyle ':prezto:module:git:info:keys' format \
         'prompt' ' on $(coalesce "%b" "%p" "%c")${git_info[rprompt]}%s' \
         'rprompt' '%C%D'

# Set ruby-info parameters.
  zstyle ':prezto:module:ruby:info:version' format ' %F{red}ruby-%v%f'

# Set node-info parameters.
  zstyle ':prezto:module:node:info:version' format ' %F{red}node-%v%f'

# Define prompts.
  PROMPT='%F{green}%~%f${(e)git_info[prompt]}
$ '
  RPROMPT='${node_info[version]},${ruby_info[version]}'
  SPROMPT='zsh: correct %F{red}%R%f to %F{green}%r%f [nyae]? '
}

function prompt_dhruva_preview {
  local +h PROMPT='%# '
  local +h RPROMPT=''
  local +h SPROMPT=''

  prompt_preview_theme 'dhruva' "$@"
}

prompt_dhruva_setup "$@"
